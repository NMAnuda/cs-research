{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/anuda/Desktop/CS%20research%20web/cs-research/front/my-app/src/app/%28police%29/History/page.js"],"sourcesContent":["const express = require('express');\r\nconst { uploads, Pdetails, Atten } = require('../models/Pdashmodouls');\r\n\r\nconst router = express.Router();\r\n\r\n// Monthly Summary Route\r\nrouter.get('/monthly-summary', async (req, res) => {\r\n  try {\r\n    const { month, year, city } = req.query;\r\n\r\n    if (!month || !year) {\r\n      return res.status(400).json({ error: 'Month and year are required' });\r\n    }\r\n    if (!city) {\r\n      return res.status(400).json({ error: 'City is required' });\r\n    }\r\n\r\n    const startDate = new Date(parseInt(year), parseInt(month) - 1, 1);\r\n    const endDate = new Date(parseInt(year), parseInt(month), 0, 23, 59, 59);\r\n\r\n    // Fetch checkpoints for the month\r\n    const checkpoints = await uploads.find({\r\n      createdAt: { $gte: startDate, $lte: endDate },\r\n      city: city,\r\n    });\r\n\r\n    // Fetch attendance records for the month\r\n    const attendanceRecords = await Atten.find({\r\n      date: { $gte: startDate, $lte: endDate },\r\n      city: city,\r\n    });\r\n\r\n    // Fetch Pdetails for mapping IDs to names\r\n    const pdetails = await Pdetails.find({ city });\r\n\r\n    // Process attendance summary (total days present per policeman)\r\n    const attendanceSummary = attendanceRecords\r\n      .filter(record => record.Attendace)\r\n      .reduce((acc, record) => {\r\n        const pdetail = pdetails.find(p => p.ID === record.ID);\r\n        const name = pdetail ? pdetail.name : 'Unknown';\r\n        acc[name] = (acc[name] || 0) + 1;\r\n        return acc;\r\n      }, {});\r\n\r\n    // Process monthly checkpoint data\r\n    const monthlyData = {\r\n      totalPhotos: checkpoints.filter(c => c.photoPath).length,\r\n      totalViolations: checkpoints.filter(c => c.violationType).length,\r\n      totalVehicleChecks: checkpoints.filter(c => c.issueType).length,\r\n      violationTypes: checkpoints.reduce((acc, c) => {\r\n        const rule = c.violationType || 'No Violation';\r\n        acc[rule] = (acc[rule] || 0) + 1;\r\n        return acc;\r\n      }, {}),\r\n      photosByPoliceman: checkpoints.reduce((acc, c) => {\r\n        const pdetail = pdetails.find(p => p.ID === c.policemanId);\r\n        const name = pdetail ? pdetail.name : 'Unknown';\r\n        acc[name] = (acc[name] || 0) + (c.photoPath ? 1 : 0);\r\n        return acc;\r\n      }, {}),\r\n      violationsByPoliceman: checkpoints.reduce((acc, c) => {\r\n        if (c.violationType) {\r\n          const pdetail = pdetails.find(p => p.ID === c.policemanId);\r\n          const name = pdetail ? pdetail.name : 'Unknown';\r\n          acc[name] = (acc[name] || 0) + 1;\r\n        }\r\n        return acc;\r\n      }, {}),\r\n      checksByPoliceman: checkpoints.reduce((acc, c) => {\r\n        if (c.issueType) {\r\n          const pdetail = pdetails.find(p => p.ID === c.policemanId);\r\n          const name = pdetail ? pdetail.name : 'Unknown';\r\n          acc[name] = (acc[name] || 0) + 1;\r\n        }\r\n        return acc;\r\n      }, {}),\r\n      illegalItemsByPoliceman: checkpoints.reduce((acc, c) => {\r\n        if (c.issueType && c.issueType !== 'No Issues') {\r\n          const pdetail = pdetails.find(p => p.ID === c.policemanId);\r\n          const name = pdetail ? pdetail.name : 'Unknown';\r\n          acc[name] = (acc[name] || 0) + 1;\r\n        }\r\n        return acc;\r\n      }, {}),\r\n      illegalItemsBreakdown: checkpoints.reduce((acc, c) => {\r\n        if (c.issueType && c.issueType !== 'No Issues') {\r\n          acc[c.issueType] = (acc[c.issueType] || 0) + 1;\r\n        }\r\n        return acc;\r\n      }, {}),\r\n    };\r\n\r\n    res.status(200).json({\r\n      checkpoints: monthlyData,\r\n      attendanceSummary: Object.fromEntries(Object.entries(attendanceSummary).map(([name, count]) => [name, { daysPresent: count }])),\r\n    });\r\n  } catch (error) {\r\n    console.error('Error generating monthly summary:', error);\r\n    res.status(500).json({ error: 'Failed to generate monthly summary' });\r\n  }\r\n});\r\n\r\n// History Route\r\nrouter.get('/history', async (req, res) => {\r\n  try {\r\n    const { city, month, year } = req.query;\r\n\r\n    if (!city) {\r\n      return res.status(400).json({ error: 'City is required' });\r\n    }\r\n\r\n    let query = { city };\r\n    if (month && year) {\r\n      const startDate = new Date(parseInt(year), parseInt(month) - 1, 1);\r\n      const endDate = new Date(parseInt(year), parseInt(month), 0, 23, 59, 59);\r\n      query.createdAt = { $gte: startDate, $lte: endDate };\r\n    } else if (year) {\r\n      const startDate = new Date(parseInt(year), 0, 1);\r\n      const endDate = new Date(parseInt(year), 11, 31, 23, 59, 59);\r\n      query.createdAt = { $gte: startDate, $lte: endDate };\r\n    }\r\n\r\n    const checkpoints = await uploads.find(query).sort({ createdAt: -1 }); // Sort by date, newest first\r\n\r\n    // Fetch Pdetails for mapping IDs to names\r\n    const pdetails = await Pdetails.find({ city });\r\n\r\n    const historyData = checkpoints.map(checkpoint => {\r\n      const pdetail = pdetails.find(p => p.ID === checkpoint.policemanId);\r\n      const policemanName = pdetail ? pdetail.name : 'Unknown';\r\n      return {\r\n        id: checkpoint._id,\r\n        violationType: checkpoint.violationType || 'None',\r\n        issueType: checkpoint.issueType || 'No Issues',\r\n        photoPath: checkpoint.photoPath || null,\r\n        date: checkpoint.createdAt,\r\n        policemanName,\r\n        city: checkpoint.city,\r\n      };\r\n    });\r\n\r\n    res.status(200).json(historyData);\r\n  } catch (error) {\r\n    console.error('Error fetching history:', error);\r\n    res.status(500).json({ error: 'Failed to fetch history' });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 236, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/anuda/Desktop/CS%20research%20web/cs-research/front/my-app/node_modules/next/dist/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":"AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,MAAQ;;AAEzC,OAAO;IACL,IAAIF,QAAQC,GAAG,CAACK,uBAA2B,EAAF;;IAczC,OAAO;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1C,IAAIP,QAAQC,GAAG,CAACO,SAAS,eAAE;gBACzBL,OAAOC,OAAO,GAAGC,QAAQ;YAC3B,OAAO;;YAEP;QACF,OAAO;;QAMP;IACF;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/anuda/Desktop/CS%20research%20web/cs-research/front/my-app/node_modules/next/dist/src/build/templates/app-page.ts"],"sourcesContent":["import type { LoaderTree } from '../../server/lib/app-dir-module'\nimport { AppPageRouteModule } from '../../server/route-modules/app-page/module.compiled' with { 'turbopack-transition': 'next-ssr' }\nimport { RouteKind } from '../../server/route-kind' with { 'turbopack-transition': 'next-server-utility' }\n\n// These are injected by the loader afterwards.\n\n/**\n * The tree created in next-app-loader that holds component segments and modules\n * and I've updated it.\n */\ndeclare const tree: LoaderTree\ndeclare const pages: any\n\n// We inject the tree and pages here so that we can use them in the route\n// module.\n// INJECT:tree\n// INJECT:pages\n\nexport { tree, pages }\n\nexport { default as GlobalError } from 'VAR_MODULE_GLOBAL_ERROR' with { 'turbopack-transition': 'next-server-utility' }\n\n// These are injected by the loader afterwards.\ndeclare const __next_app_require__: (id: string | number) => unknown\ndeclare const __next_app_load_chunk__: (id: string | number) => Promise<unknown>\n\n// INJECT:__next_app_require__\n// INJECT:__next_app_load_chunk__\n\nexport const __next_app__ = {\n  require: __next_app_require__,\n  loadChunk: __next_app_load_chunk__,\n}\n\nexport * from '../../server/app-render/entry-base' with { 'turbopack-transition': 'next-server-utility' }\n\n// Create and export the route module that will be consumed.\nexport const routeModule = new AppPageRouteModule({\n  definition: {\n    kind: RouteKind.APP_PAGE,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n    appPaths: [],\n  },\n  userland: {\n    loaderTree: tree,\n  },\n})\n"],"names":["AppPageRouteModule","RouteKind","tree","pages","default","GlobalError","__next_app__","require","__next_app_require__","loadChunk","__next_app_load_chunk__","routeModule","definition","kind","APP_PAGE","page","pathname","bundlePath","filename","appPaths","userland","loaderTree"],"mappings":";;;;;;AACA,SAASA,kBAAkB,QAAQ,2DAA2D;IAAE,wBAAwB;AAAW,EAAC;IACzE,wBAAwB;AAWnF,yEAAyE;AAEzE,cAAc;AAGd,SAASE,IAAI,EAAEC,KAAK,GAAE;IAapBM,WAAWC;AAGb,cAAc,0CAA0C;AAExD,4DAA4D;;;;;;;;;;;;;;;;QAGxDG,MAAMZ,UAAUa,QAAQ,yCAAA;QACxBC,EAAAA,IAAM;QACNC,KAAAA;IAAAA;IAAU;gBACV,IAAA;YAAA;YAAA,0BAA2C;wBAC3CC,IAAAA;oBAAAA,OAAY;oBAAA;gCACZC,IAAAA;4BAAAA,KAAU;4BAAA;iCACVC,UAAU,EAAE;kCACd,QAAA,CAAA;gCAAA,QAAA;oCAAA,IAAA;oCAAA;iCAAA;;2BACAC,UAAU;;yBACRC,YAAYnB;0BACd,QAAA,CAAA;oBAAA;iBAAA;YACF;YAAE","ignoreList":[0],"debugId":null}}]
}